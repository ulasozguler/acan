<title>Acan Demo Page</title>
<script src="js/utils.js"></script>
<script src="js/grid.js"></script>
<script src="js/world.js"></script>
<script src="js/simulation-interface.js"></script>
<script src="js/examples/game-of-life.js"></script>
<script src="js/examples/langtons-ant.js"></script>
<link rel="stylesheet" href="main.css"/>

<canvas id="test"></canvas>

<div id="controls">
    <select id="simulation">
        <option value="GameOfLife">Game of Life</option>
        <option value="LangtonsAnt">Langton's Ant</option>
    </select>
    <a id="run">Run</a>
    <a id="pause">Pause</a>
    <a id="step">Step</a>
    <a id="reset">Reset</a>

    <label for="stepDelay">Step delay (ms)</label>
    <input type="number" id="stepDelay" value="100">

    <label for="iterationCount">Iteration #</label>
    <input type="number" id="iterationCount" value="0" disabled>
</div>

<div id="legend"></div>


<script>
    var simulation = GameOfLife;
    var width = 75;
    var height = 50;

    var w = new World(width, height);
    w.setSimulation(simulation);

    var grid = new Grid('test', width, height);
    if(simulation.colorPicker) {
        grid.colorPicker = simulation.colorPicker;
    }

    function redraw() {
        grid.updateData(w.getData());
        document.getElementById('legend').innerHTML = grid.getColorMapHTML();
    }

    var generationDisplay = document.getElementById('iterationCount');
    function step() {
        w.step();
        generationDisplay.value = w.generation;
        redraw();
    }

    // ui stuff
    var stepDelayInput = document.getElementById('stepDelay');
    var paused = true;
    function run() {
        step();
        if(!paused) {
            setTimeout(run, Number(stepDelayInput.value));
        }
    }

    var runButton = document.getElementById('run');
    var pauseButton = document.getElementById('pause');

    runButton.style.display = 'none';
    runButton.addEventListener('click', function() {
        if(paused) {
            paused = false;
            run();
            runButton.style.display = 'none';
            pauseButton.style.display = 'block';
        }
    });

    pauseButton.addEventListener('click', function() {
        paused = true;
        runButton.style.display = 'block';
        pauseButton.style.display = 'none';
    });

    document.getElementById('step').addEventListener('click', step);

    document.getElementById('reset').addEventListener('click', function() {
        w.reset();
        redraw();
    });

    var sims = {
        'GameOfLife': GameOfLife,
        'LangtonsAnt': LangtonsAnt
    };
    function changeSim(simName) {
        var sim = sims[simName];
        w.setSimulation(sim);
        w.reset();

        grid.reset();
        if(sim.colorPicker) {
            grid.colorPicker = sim.colorPicker;
        }

        redraw();
    }

    var simSelect = document.getElementById('simulation');
    simSelect.addEventListener('change', function(e) {
        changeSim(e.target.value);
    });

    // initial
    window.onload = function() {
        if(window.location.hash) {
            var sim = window.location.hash.substring(1);
            if(sims.hasOwnProperty(sim)) {
                simSelect.value = sim;
                changeSim(sim);
            }
        }

        redraw();

        paused = false;
        run();
    };
</script>
