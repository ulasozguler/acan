<title>Acan Demo Page</title>
<script src="js/utils.js"></script>
<script src="js/grid.js"></script>
<script src="js/world.js"></script>
<script src="js/simulation-interface.js"></script>
<script src="js/examples/game-of-life.js"></script>
<script src="js/examples/langtons-ant.js"></script>
<script src="js/examples/racist-people.js"></script>
<link rel="stylesheet" href="main.css"/>

<canvas id="test"></canvas>

<div id="controls">
    <select id="simulation"></select>
    <a id="run">Run</a>
    <a id="pause">Pause</a>
    <a id="step">Step</a>
    <a id="reset">Reset</a>

    <label for="stepDelay">Step delay (ms)</label>
    <input type="number" id="stepDelay" value="100">

    <label for="iterationCount">Iteration #</label>
    <input type="number" id="iterationCount" value="0" disabled>

    <div id="stats"></div>
</div>

<div id="legend"></div>


<script>
    // init
    var sims = {
        'Game of Life': GameOfLife,
        'Langton\'s Ant': LangtonsAnt,
        'Racist People': RacistPeople
    };
    var simulation = GameOfLife;
    var width = 75;
    var height = 50;

    var world = new World(width, height);
    world.setSimulation(simulation);

    var grid = new Grid('test', width, height);
    if(simulation.colorPicker) {
        grid.colorPicker = simulation.colorPicker;
    }

    // helpers
    function redraw() {
        grid.updateData(world.getData());
        document.getElementById('legend').innerHTML = grid.getColorMapHTML();
        renderStats();
    }

    function step() {
        var res = world.step();
        generationDisplay.value = world.generation;
        redraw();
        return res;
    }

    var paused = true;
    function startLoop() {
        if(step()) { // finished
            pause();
        }
        if(!paused) {
            setTimeout(startLoop, Number(stepDelayInput.value));
        }
    }

    function changeSim(simName) {
        var sim = sims[simName];
        world.setSimulation(sim);
        world.reset();

        grid.reset();
        if(sim.colorPicker) {
            grid.colorPicker = sim.colorPicker;
        }

        redraw();
    }

    function renderStats() {
        var html = '<table>';
        var stats = world.getStats();
        for(var stat in stats) {
            if(!stats.hasOwnProperty(stat)) continue;
            html += '<tr><td>' + stat + '</td><td>' + stats[stat] + '</td></tr>';
        }
        html += '</table>';
        document.getElementById('stats').innerHTML = html;
    }

    // ui stuff
    var stepDelayInput = document.getElementById('stepDelay');
    var generationDisplay = document.getElementById('iterationCount');
    var runButton = document.getElementById('run');
    var pauseButton = document.getElementById('pause');
    var stepButton = document.getElementById('step');
    var resetButton = document.getElementById('reset');
    var simSelect = document.getElementById('simulation');

    // add simulations
    for(var sim in sims) {
        if(!sims.hasOwnProperty(sim)) continue;
        var option = document.createElement('option');
        option.value = sim;
        option.innerText = sim;
        simSelect.appendChild(option);
    }

    function run() {
        paused = false;
        runButton.style.display = 'none';
        pauseButton.style.display = 'block';
        startLoop();
    }

    function pause() {
        paused = true;
        runButton.style.display = 'block';
        pauseButton.style.display = 'none';
    }

    runButton.addEventListener('click', run);
    pauseButton.addEventListener('click', pause);
    stepButton.addEventListener('click', step);
    resetButton.addEventListener('click', function() {
        world.reset();
        redraw();
    });
    simSelect.addEventListener('change', function(e) {
        changeSim(e.target.value);
    });

    // initial
    window.onload = function() {
        if(window.location.hash) {
            var sim = window.location.hash.substring(1);
            if(sims.hasOwnProperty(sim)) {
                simSelect.value = sim;
                changeSim(sim);
            }
        }
        run();
    };
</script>
