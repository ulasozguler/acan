<script src="js/utils.js"></script>
<script src="js/grid.js"></script>
<script src="js/world.js"></script>
<script src="js/examples/game-of-life.js"></script>
<link rel="stylesheet" href="main.css"/>

<canvas id="test"></canvas>

<div id="controls">
    <a id="run">Run</a>
    <a id="pause">Pause</a>
    <a id="step">Step</a>
    <br/>
    <br/>
    <label for="initialAlive">Initial alive count</label>
    <input type="number" id="initialAlive" value="1250">
    <a id="reset">Reset</a>
</div>

<div id="legend">dsads</div>


<script>
    var width = 75;
    var height = 50;
    var defaultCell = {alive: 0};
    var stepDelay = 100;

    var w = new World(width, height, defaultCell);
    w.setBehaviour(GameOfLife.behaviour);

    var grid = new Grid('test', width, height);

    function generateRandom(count) {
        // random generation
        w.clear();
        for(var i = 0; i < count; i++) {
            w.setCell(randInt(0, width - 1), randInt(0, height - 1), {alive: 1});
        }
    }

    function redraw() {
        grid.updateData(w.getData());
        document.getElementById('legend').innerHTML = grid.getColorMapHTML();
    }

    function step() {
        w.step();
        redraw();
    }

    // ui stuff
    var paused = true;
    function run() {
        step();
        if(!paused) {
            setTimeout(run, stepDelay);
        }
    }

    var runButton = document.getElementById('run');
    var pauseButton = document.getElementById('pause');
    pauseButton.style.display = 'none';

    runButton.addEventListener('click', function() {
        if(paused) {
            paused = false;
            run();
            runButton.style.display = 'none';
            pauseButton.style.display = 'block';
        }
    });

    pauseButton.addEventListener('click', function() {
        paused = true;
        runButton.style.display = 'block';
        pauseButton.style.display = 'none';
    });

    document.getElementById('step').addEventListener('click', step);

    document.getElementById('reset').addEventListener('click', function() {
        generateRandom(Number(document.getElementById('initialAlive').value));
        redraw();
    });

    // initial
    window.onload = function() {
        generateRandom(Number(document.getElementById('initialAlive').value));
        redraw();
    };
</script>
